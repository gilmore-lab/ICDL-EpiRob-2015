---
title: "ICDL-EpiRob-15"
author: "Rick O. Gilmore"
date: "`r Sys.Date()`"
output: ioslides_presentation
---

## What Accounts for Developmental Shifts in Optic Flow Sensitivity?

Rick O. Gilmore, Penn State

Florian Raudies, HP Labs

Swapnaa Jayaraman, Indiana University

<https://nyu.databrary.org/volume/81>
<https://github.com/gilmore-lab/ICDL-EpiRob-2015>

*Support*: NSF BCS-1147440, NSF BCS-1238599, NICHD U01-HD-076595

## Background

- What is Optic Flow?
- How Does Optic Flow Sensitivity Develop?

## What is Optic Flow?

- Structured pattern of visual motion generated by observer movement
- Radial, rotational, translational/laminar patterns

<img src="../figs/optic-flow-types.png"/>

## How Does Optic Flow Sensitivity Develop?

- Sensitivity at birth
- Infants more sensitive to fast, translational flow
- Adults more sensitive to slow, radial flow

## Natural Scene Statistics of Optic Flow

- [*Raudies & Gilmore ICDL-EpiRob 2012*](http://ieeexplore.ieee.org/xpl/login.jsp?tp=&arnumber=6400584&url=http%3A%2F%2Fieeexplore.ieee.org%2Fxpls%2Fabs_all.jsp%3Farnumber%3D6400584)
    - Infants experience faster flow than mothers even geometry, speed of locomotion equated.
- [*Raudies & Gilmore, Neural Computation, 2014*](http://www.mitpressjournals.org/doi/abs/10.1162/NECO_a_00645#.Va6g-hNViko)
    - Motion "prior" for infants faster than for mothers
    - Empirical motion priors not "slow" as predicted by theory

## This Study Asks

- What are the statistics of infants' optic flow experiences in more natural contexts?
- Do the statistics help explain development in sensitivity?
- Do cultural differences (home geometries, carrying practices, etc.) carry much weight?
- Are fast, translational flows common?

## Approach

- Simulating changes in optic flow due to changes in body size & posture, geometry
- Empirical measurement of flow experienced in natural contexts

## Theoretical Framework

- What changes in *development* or *culture* might influence optic flow?
- Posture: Walking vs. Crawling
    - Distance to ground surface
    - Head pitch relative to ground
- Geometry: Typical distance to surfaces, objects

- $\begin{pmatrix}\dot{x} \\ \dot{y}\end{pmatrix}=\frac{1}{z}
\begin{pmatrix}-f & 0 & x\\ 0 & -f  & y \end{pmatrix}
\begin{pmatrix}{v_x{}}\\ {v_y{}} \\{v_z{}}\end{pmatrix}+
\frac{1}{f}
\begin{pmatrix}
xy & -(f^2+x^2) & fy\\ 
f^2+y^2 & -xy & -fy
\end{pmatrix}
\begin{pmatrix}
\omega_{x}\\ 
\omega_{y}\\ 
\omega_{z}
\end{pmatrix}$

## Simulating Effects of Posture, Geometry

<img src='../figs/simulation-flow-patterns.png' width=800px/>

## Simulated Flow Direction Distributions by Posture & Geometry

<img src='../figs/simulation-flow-direction-hist.png' width=800px/>

## Empirical Measurements of Optic Flow

- First-person videos from head-mounted cameras
- 41 days to 13.2 mos
- Tamil Nadu, India & Bloomington, Indiana

<http://databrary.org/volume/81>

## Crawl vs. Walk Speeds By Geometry

```{r configuration, echo=FALSE, warning=FALSE, message=FALSE, include=FALSE}
# Source libraries
library(ggplot2)
library(dplyr)
library(nlme)
library(knitr)
library(tidyr)

# Directories
dir.data <- '../data'
dir.figs <- '../figs'

# File names
fn_sim_spd_hist <- 'simulation-speed-hist.csv'
fn_seg_duration <- 'coded-segments.csv'
fn_spd_hist_bins <- 'speed-histogram-bins.csv'
fn_spd_hist_fits <- 'speed-histogram-fits.csv'

# Load speed histogram data from simulation
df.in <- read.csv( paste(dir.data, fn_sim_spd_hist, sep="/"), header=FALSE )

geom.names <- unlist( df.in[,1] )
locomotion.names <- unlist( df.in[,2] )
vals <- t( df.in[,3:23] )

bins <- seq(0,45, length.out=21)

df.th <- data.frame( Bin.Ctr = bins,
                     Geometry = rep( geom.names, each=21 ),
                     Locomotion = rep( locomotion.names, each=21 ),
                     Bin.Ct = as.vector( unlist( vals ) ) 
)

# Summarize counts by locomotion status
df.th.crawl <- df.th %>%
  filter( Locomotion == "crawling" ) %>%
  group_by( Geometry, Bin.Ctr ) %>%
  summarize( crawling.ct = sum( Bin.Ct) )

df.th.walk <- df.th %>%
  filter( Locomotion == "walking") %>%
  group_by( Geometry, Bin.Ctr ) %>%
  summarize( walking.ct = sum( Bin.Ct ))

# Merge data frames for analysis
df.th.loco <- merge( df.th.crawl, df.th.walk, 
                     by.x=c("Geometry", "Bin.Ctr"), 
                     by.y=c("Geometry", "Bin.Ctr")
) %>% mutate( tot.ct = crawling.ct + walking.ct ) %>%
  group_by( Geometry ) %>%
  mutate( tot.geom.ct = sum( tot.ct ) ) 

p.thresh = .05
df.th.loco.stats <- df.th.loco %>%
  filter(tot.ct >= 5) %>%
  mutate( num = (walking.ct/tot.geom.ct - crawling.ct/tot.geom.ct)^2,
          denom = walking.ct/(tot.geom.ct^2) + crawling.ct/(tot.geom.ct)^2,
          chisq = num/denom ) %>%
  group_by(Geometry) %>%
  summarize( chisq.loco = sum( chisq ) ) %>%
  mutate( p.chisq = 1-pchisq( chisq.loco, 21) ) %>%
  filter( p.chisq < p.thresh )
```

```{r simulation-histogram-plot, echo=FALSE, warning=FALSE, message=FALSE}
# Plot
p <- ggplot( data=df.th, aes(x=Bin.Ctr, y=Bin.Ct, fill=Locomotion)) +
  geom_bar(position="dodge", stat="identity") +
  facet_grid(. ~ Geometry)+
  xlab("Speed (deg/s)") +
  ylab("Number of observations") +
  theme( strip.text=element_text(size=14), 
         axis.title=element_text(size=14),
         legend.position="bottom")
p
```

## Statistics Comparing Crawling vs. Walking Speeds by Geometry

```{r simulation-histogram-stats, echo=FALSE, warning=FALSE, message=FALSE}
p.thresh = .05
df.th.loco.stats <- df.th.loco %>%
  filter(tot.ct >= 5) %>%
  mutate( num = (walking.ct/tot.geom.ct - crawling.ct/tot.geom.ct)^2,
          denom = walking.ct/(tot.geom.ct^2) + crawling.ct/(tot.geom.ct)^2,
          chisq = num/denom ) %>%
  group_by(Geometry) %>%
  summarize( chisq.loco = sum( chisq ) ) %>%
  mutate( p.chisq = 1-pchisq( chisq.loco, 21) ) %>%
  filter( p.chisq < p.thresh )
df.th.loco.stats %>%
  kable()
```

## Cultural Differences in Segment Durations

```{r segment-durations, echo=FALSE, warning=FALSE, message=FALSE}
# read data file
df.segments <- read.csv(paste(dir.data, fn_seg_duration, sep="/"))

# Restrict consideration to segments < 3 min
df.segments.3m <- df.segments %>% 
  mutate(Minutes=Segment.ms/(1000*60)) %>%
  filter(Motion.Static != 'Unclassified') %>%
  filter(Minutes <= 3)

# Adjust country order
countries <- relevel(df.segments.3m$Country, "U.S.")
df.segments.3m$Country <- countries

# Calculate summary stats to annotate plot
df.summary <- df.segments.3m %>%
  group_by(Country, Motion.Static) %>%
  summarize(Minutes.med = median(Minutes),
            Minutes.mean = mean(Minutes))

df.summary$Minutes = c(1,1,1,1)

# Convert minutes to seconds for readability
df.summary$Label.med = paste0("median = ", round(df.summary$Minutes.med*60, 1), " s")
df.summary$Label.mean = paste0("mean = ", round(df.summary$Minutes.mean*60, 1), " s")

# Plot
p <- ggplot(df.segments.3m, aes(x=Minutes)) +
  facet_grid(Motion.Static ~ Country) + 
  geom_histogram() +
  ylab('Number of Segments') +
  xlab('Segment Duration (min)') +
  theme_bw()

p + 
  geom_text(data=df.summary, aes(x=rep(1.5,4), y=rep(400,4), label=Label.med), size=7) +
  geom_text(data=df.summary, aes(x=rep(1.5,4), y=rep(300,4), label=Label.mean), size=7) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  theme(strip.text = element_text(size=20), 
        axis.title = element_text(size=20),
        axis.text = element_text(size=20))
```

## Individual Differences in Segment Durations

```{r segment-durations-individual-diffs, echo=FALSE, warning=FALSE, message=FALSE}

p <- ggplot(data=df.segments.3m, aes(x=Minutes, color=Participant.ID)) +
  facet_grid(Motion.Static ~ Country) +
  geom_density() +
  ylab('Density') +
  xlab('Segment Duration (min)') +
  guides(color=FALSE) +
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        strip.text = element_text(size=20), 
        axis.title = element_text(size=20),
        axis.text = element_text(size=20)
  )
p
```

## Statistical Analysis

```{r statistics-segment-duration, echo=FALSE, warning=FALSE, message=FALSE}

# Restrict analysis to Moving and Stationary conditions
keep <- c("Moving", "Stationary", echo=FALSE, warning=FALSE, message=FALSE)
df.motion.static <- subset(df.segments, Motion.Static %in% keep)
df.motion.static$Motion.Static <- factor(df.motion.static$Motion.Static)

# Restrict to segments < 1.5 min to reduce effects of outliers
df.trim.1.5min <- df.motion.static %>%
  filter(Segment.ms <= 1.5*60*1000) # Trim ms < 90,000 ms or 1.5 min
lme.trim.1.5min <- lme(data=df.trim.1.5min, fixed=Segment.ms ~ Motion.Static*Country*AgeMatchGroup, random = ~ 1 | Participant.ID)
anova(lme.trim.1.5min) %>% 
  kable()
```

## Summary of Segment Duration Effects

```{r anova-segment-duration-plot, echo=FALSE, warning=FALSE, message=FALSE}

# Create summary data frame
df.trim.1.5min.summ <- df.trim.1.5min %>%
  group_by(AgeMatchGroup, Country, Participant.ID, Motion.Static) %>%
  summarize(Segment.ms.med = median(Segment.ms),
             Segment.ms.sem  = sd(Segment.ms)/sqrt(n()),
             Segment.ms.mean = mean(Segment.ms)) %>%
  mutate(Segment.sec.mean=Segment.ms.mean/1000, Segment.sec.sem=Segment.ms.sem/1000)

c <- relevel( df.trim.1.5min.summ$Country, "U.S.") # make U.S. first for consistency
df.trim.1.5min.summ$Country <- c

# Plot
ylims <- aes(ymax=Segment.sec.mean+Segment.sec.sem, ymin=Segment.sec.mean-Segment.sec.sem)
p7 <- ggplot( data=df.trim.1.5min.summ, aes(x=AgeMatchGroup, y=Segment.sec.mean, color=Motion.Static)) +
  facet_grid(. ~ Country) +
  geom_point() +
  geom_pointrange(ylims) +
  geom_smooth( method=lm ) +
  scale_color_discrete( name="Motion Status") +
  theme( legend.position="bottom") +
  xlab("Age Group (wks)") +
  ylab("Segment Duration (s)") +
  theme(strip.text=element_text(size=14), axis.title=element_text(size=14))
p7
```

## Normalized Durations as p(total-time)

```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Start with untrimmed.
# Fix leveling order...again
c <- relevel( df.motion.static$Country, "U.S.") # make U.S. first for consistency
df.motion.static$Country <- c

# Sum total duration by participant and motion condition
df.motion.static.summ.by.motion <- df.motion.static %>%
  group_by(Country, AgeMatchGroup, Participant.ID, Motion.Static) %>%
  summarize(Segment.ms.tot = sum(Segment.ms))

df.motion.static.summ.grand <- df.motion.static.summ.by.motion %>%
  group_by(Country, AgeMatchGroup, Participant.ID) %>%
  summarize(Segment.ms.tot.grand = sum(Segment.ms.tot))

df.motion.static.summ <- merge( df.motion.static.summ.grand, df.motion.static.summ.by.motion)

df.motion.static.summ <- df.motion.static.summ %>%
  group_by( Country, AgeMatchGroup, Participant.ID, Motion.Static) %>%
  summarize(Segment.ms.p = Segment.ms.tot/Segment.ms.tot.grand)

# Now plot
p <- ggplot(data=df.motion.static.summ, aes(x=AgeMatchGroup, y=Segment.ms.p, color= Motion.Static)) +
  facet_grid( . ~ Country ) +
  geom_point() + 
  geom_smooth( method=lm ) +
  xlab("Age Group (wks)") +
  ylab("Proportion of Time") +
  theme(strip.text = element_text(size=20), 
        axis.title = element_text(size=20),
        axis.text = element_text(size=20),
        legend.text = element_text(size=18),
        legend.title = element_text(size=18)) +
  theme(legend.position="bottom") + 
  scale_color_discrete(name="Motion Status")
p
```

## Statistics for Segment Durations as p(total-time)

```{r p-total-segment-duration-stats, echo=FALSE, warning=FALSE, message=FALSE}
# Since Motion.Static proportions are not independent
lme.p.segment <- lme(fixed = Segment.ms.p ~ Country*AgeMatchGroup, data = df.motion.static.summ[df.motion.static.summ$Motion.Static=='Stationary',], random = ~ 1 | Participant.ID)
anova(lme.p.segment) %>% 
  kable()
```

## Natural Scene Statistics for Optic Flow

- Selected 5 x 5 s segments/participant, both moving and stationary
- Estimated frame by frame flow fields
- Details in Raudies & Gilmore 2014.

## Speed Distributions

```{r speed-distributions-US, echo=FALSE, warning=FALSE, message=FALSE}
# Load data
df_speed_hist <- read.csv(paste(dir.data, fn_spd_hist_bins, sep="/"))

# U.S Histogram
p <- df_speed_hist %>% 
  filter(Country == "U.S.") %>%
  ggplot(aes(x=Speed, y=N_obs)) +
  facet_grid(Participant.ID ~ Motion_status) +
  geom_bar(stat="identity") +
  ggtitle("U.S")
p
```

## Speed Distributions

```{r speed-distributions-India, echo=FALSE, warning=FALSE, message=FALSE}
# India Histogram
p <- df_speed_hist %>% 
  filter(Country == "India") %>%
  ggplot(aes(x=Speed, y=N_obs)) +
  facet_grid(Participant.ID ~ Motion_status) +
  geom_bar(stat="identity") +
  ggtitle("India")
p
```

## Comparing Shape of (Trimmed) Speed Distributions

- Fit $\gamma$ distribution to trimmed speed histograms

- $f(x;k,\theta) =  \alpha\frac{x^{k-1}e^{-\frac{x}{\theta}}}{\theta^k\Gamma(k)}$

- $\alpha$, amplitude; $\kappa$, shape; and $\theta$, scale parameters.

##

<img src='../figs/speed-histograms-trimmed.jpg' width=800px/>

## Analysis of Fitted Parameters

```{r speed-fitted-parameters, echo=FALSE, warning=FALSE, message=FALSE}
# Load data
df.merged <- read.csv(paste(dir.data, fn_spd_hist_fits, sep="/"))

# Re-label to fix country order
countries <- relevel(df.merged$Country, "U.S.")
df.merged$Country <- countries

# Fix Motion.Static level labels
levels(df.merged$Motion.Static) <- c("Moving", "Stationary")

# Plot $\kappa$ parameter
p.k <- df.merged %>%
  gather(Parameter.name, Fitted.value, alpha, kappa, theta ) %>%
  filter(Parameter.name=='kappa') %>%
  ggplot(aes(x=Motion.Static, y=Fitted.value, color=Motion.Static)) +
  facet_grid(. ~ Country) +
  geom_boxplot() +
  geom_point() +
  ggtitle(expression(paste("Distribution of ", kappa, " parameter"))) + 
  xlab("") + 
  ylab("Parameter Estimate")
p.k
```

## Change in $\kappa$ Across Age

```{r kappa-by-age, echo=FALSE, warning=FALSE, message=FALSE}
p.k <- df.merged %>%
  gather(Parameter.name, Fitted.value, alpha, kappa, theta ) %>%
  filter(Parameter.name=='kappa') %>%
  ggplot(aes(x=Age_group_match, y=Fitted.value, color=Motion.Static)) +
  facet_grid(. ~ Country) +
  geom_point() +
  geom_smooth(method=lm) +
  ggtitle(expression(paste("Distribution of ", kappa, " parameter"))) +
  xlab("Age Group (mos)") +
  ylab("Parameter Estimate")
p.k
```

## Statistics

```{r spd-fitted-parameters-manova, echo=FALSE, warning=FALSE, message=FALSE}
lme.k.country <- lme(fixed = kappa ~ Motion.Static*Age_group_match + Country, random = ~ 1 | Participant.ID, data=df.merged)
anova(lme.k.country) %>%
  kable()
```

## Empirical Pattern Distributions

- Correlation with 'canonical' flow patterns
  - radial
  - rotational
  - translational
  
## Pattern Correlation Results

<img src='../figs/pattern-correlations.jpg' width=800px/>

## Conclusions

- Posture influences optic flow speeds & patterns
    - Crawling: faster speeds, more translational flow
    - Proximity to ground and pitch of head
    - Geometry matters little
    
## Conclusions

- Empirical optic flow data show
    - Fast speeds, frequent translational flow
    - Influence of motion status
    - Individual differences
    - Broader speed distribution, increase in time spent moving with age in India
    - Modest effects of culture
    
## Questions to Ponder

- Do optic flow experiences shape perception?
- Do experiences shape optic flow-related brain responses?

## Stack

- Databrary, <https://nyu.databrary.org/volume/81>
    - Access to identifiable data (e.g. videos) restricted
    - Access agreement + institutional authorization
- Datayvu, <http://datavyu.org>
- Matlab
- RStudio, <https://www.rstudio.com/>
    - R Markdown, <http://rmarkdown.rstudio.com/>
- GitHub, <http://github.com/gilmore-lab/ICDL-EpiRob-2015>